<script>
    let bombPositions = [];
    let saldo = Number(localStorage.getItem('saldo')) || 0;
    let valorAposta = 0;
    let celulasReveladas = 0;
    let multiplicadorAtual = 1;
    let multiplicadorBase = 1;
    let incrementoMultiplicador = 0;
    let jogoAtivo = false;
    let celulasClicadas = new Set();

    document.addEventListener('DOMContentLoaded', function () {
        updateSaldo();
    });

    function updateSaldo() {
        document.getElementById('saldo-value').textContent = saldo.toFixed(2);
        localStorage.setItem('saldo', saldo);
    }

    function iniciarJogo() {
        valorAposta = Number(document.getElementById('valorAposta').value);
        const numBombas = parseInt(document.getElementById('numBombas').value);

        if (valorAposta < 1 || valorAposta > saldo) {
            alert('Aposta invÃ¡lida ou saldo insuficiente!');
            return;
        }

        const multiplicadores = {
            1: [1.1, 0.2],
            2: [1.2, 0.3],
            3: [1.3, 0.4],
            4: [1.4, 0.55],
            5: [1.5, 0.65]
        };

        [multiplicadorBase, incrementoMultiplicador] = multiplicadores[numBombas];

        multiplicadorAtual = multiplicadorBase;
        saldo -= valorAposta;
        updateSaldo();

        bombPositions = [];
        while (bombPositions.length < numBombas) {
            const pos = Math.floor(Math.random() * 25);
            if (!bombPositions.includes(pos)) bombPositions.push(pos);
        }

        const grid = document.getElementById('mines-grid');
        grid.innerHTML = '';
        celulasReveladas = 0;
        celulasClicadas.clear();
        jogoAtivo = true;

        for (let i = 0; i < 25; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.index = i;
            cell.onclick = () => revelarCelula(i, cell);
            grid.appendChild(cell);
        }

        document.getElementById('resultado').textContent = '';
        document.getElementById('pararBtn').disabled = false;
    }

    function revelarCelula(pos, cell) {
        if (!jogoAtivo || celulasClicadas.has(pos)) return;

        celulasClicadas.add(pos);

        if (bombPositions.includes(pos)) {
            cell.className = 'cell bomb';
            cell.textContent = 'ðŸ’£';
            document.getElementById('resultado').textContent = 'VocÃª perdeu! ðŸ’¥';
            document.getElementById('pararBtn').disabled = true;
            jogoAtivo = false;
            mostrarBombas();
        } else {
            cell.className = 'cell revealed';
            cell.textContent = multiplicadorAtual.toFixed(1) + 'x';
            celulasReveladas++;
            multiplicadorAtual += incrementoMultiplicador;
            document.getElementById('multiplicador').textContent = multiplicadorAtual.toFixed(2) + 'x';
        }
    }

    function pararJogo() {
        if (!jogoAtivo) return;

        const ganhoLiquido = (valorAposta * multiplicadorAtual) * 0.875;
        saldo += ganhoLiquido;
        updateSaldo();

        document.getElementById('resultado').textContent = `VocÃª sacou R$ ${ganhoLiquido.toFixed(2)}! ðŸ¤‘`;
        document.getElementById('pararBtn').disabled = true;
        jogoAtivo = false;
        mostrarBombas();
    }

    function mostrarBombas() {
        bombPositions.forEach(pos => {
            const cell = document.getElementById('mines-grid').children[pos];
            cell.className = 'cell bomb';
            cell.textContent = 'ðŸ’£';
        });
    }
</script>
